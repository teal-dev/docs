---
title: "Categorization configuration"
description: "How to configure auto-categorization on submitted and fetched transactions."
icon: "user-gear"
---

## Overview of categorization in Teal

When you [submit a new transaction](/transactions/submitting) to Teal, the transactions will run through the categorization pipeline that you have configured on the categorization tab in the [developer portal](https://developer.teal.dev/categorization).

The categorization pipeline is intended to be a first cut at categorizing transactions into the appropriate accounting ledgers. This provides a better UX for the user, as they will not need to manually categorize the majority of transactions.

This pipeline consists of three categorization steps, each of which can be indepedently enabled and configured.

- **Step 1:** Transfers between accounts
- **Step 2:** Categorizing via rules
- **Step 3:** AI Categorization

If a transaction is categorized by one of the steps, it will skip the rest of the pipeline and not be categorized by any subsequent step. 

If no categorization step matches a transaction, the transaction will be categorized into the "Uncategorized cash inflow" or "Uncategorized cash outflow" ledger.

All auto-categorization steps are disabled by default, and will not run until manually enabled in the developer portal.

## Transfers between accounts

The first step in auto-categorization is to recognize when a transaction is a transfer of funds between two financial accounts.

This is the only auto-categorization step that will generate multiple journal entries, because the date that the funds leave one account may not be the same as the date that they arrive in the other account.

The journal entry that records the funds leaving an account will credit the financial account, and debit the special ledger titled "Transfers Between Accounts." This special ledger will hold the balance of funds until they arrive in the receiving account, on which date, a corresponding journal entry will be created that credits "Transfers Between Accounts" and debits the receiving account.

The transfers between accounts step identifies transfers by finding cash inflows and outflows of exactly the same amount within 7 calendar days of one another. It only identifies these transactions after both the inflow and outflow exist in the system.

If you (or your user) knows that a cash outflow is a transfer between accounts before the corresponding inflow has been received, you can manually categorize the line entry to transfer between accounts. The system will then automatically categorize the corresponding inflow when it arrives.

## Categorizing via rules

Platforms have the ability to set their own categorization rules. This feature enables you to define specific rules, which, when matched, will automatically categorize a transaction into a particular ledger.

Categorization rules are set at the **Platform level**. We don't currently offer User level categorization rules (please contact this if this is an important feature to you). We plan to implement user-level categorization rules in a future release.

A rule consists of three components:

- **Priority**: If multiple rules match a transaction, the rule with the highest priority will be implemented first.
- **Expression**: A conditional statement that is evaluated against each transaction to determine whether it satisfies the criteria of the rule.
- **Target Ledger Name**: This is the name of the ledger into which the transaction will be categorized if the rule conditions are met. If the specified ledger name doesn't exist in a user's chart of accounts, the system will disregard the rule.

### Crafting an Expression

The expression is a crucial part of the rule, as it determines the conditions under which a rule matches a transaction. For a rule to be applicable, the expression should evaluate to `True` for a transaction. Any other value will result in a non-match.

### Referencing the Transaction Object

Within the expression, you can reference the transaction object using the symbol `t`. You can access the properties of a transaction using the `.` character. For example, `t.description` will return the description of the transaction.

#### Metadata

Some transactions come with additional information in the form of metadata, an arbitrary key-value map. The specific contents of this map depend on the source of the transaction.

You can access the values in the metadata map within an expression, using the `.` character. For example, `t.metadata.transaction_type` would yield the value mapped to the `transaction_type` key in the metadata.

Here is a generic representation of a Transaction object:

```
Transaction {
  description: String
  datetime: DateTime
  amount: Decimal
  metadata: Map[String, String]
}
```

### Operators and Literals

Expressions may include the following operators and literals:

- **Operators**
  - `and`, `or` for logical AND and OR operations
  - `()` for defining the order of operations
  - `==`, `>`, `>=`, `<`, `<=` for equality and comparison
  - `+`, `-`, `*`, `/`, `%` for mathematical operations
- **If/else Expression**
  - `true_expr **if** boolean_expr **else** false_expr`
- **Literals**

  - Strings: `"string"`
  - Numbers: `1.23`
  - Booleans: `True`, `False`
  - Datetime: `datetime("2023-01-10T00:00:00.000Z")`

### Regular Expressions

You can also use regular expressions in your rule's expression using the `match(pattern, text)` function. You can learn more about regular expressions and their syntax [here](https://developers.google.com/edu/python/regular-expressions).

### Examples

#### Payments to a Specific Vendor

A rule that checks if the transaction description contains "Slack":

```python
match("Slack", t.description)
```

#### Payments to a specific merchant over a given threshold amount

A rule that applies to any transaction where the vendor is "Chevron" and the amount is more than $50:

```python
match("Chevron", t.description) and t.amount > 50
```

#### Transactions with Certain Metadata

A rule that looks for transactions with a `counterparty` attribute in the metadata set to "Sophie's Contracting LLC":

```python
t.metadata.counterparty == "Sophie's Contracting LLC"
```

## AI Categorization

The final step in the categorization pipeline is AI categorization. This step uses a large language model to categorize transactions into the appropriate ledger.

The advantage of AI categorization is that it can handle new and unanticipated kinds of transactions, whereas rules need to be pre-configured, generally from past experience.

The other advantage of AI categorization is that it does not require an existing corpus of structured data to work. You can freely customize your chart of accounts, and the AI will use it intelligently, without requiring any training data specific to the chart of accounts.

The disadvantage of AI categorization is that it is slow and sometimes unpredictable. When AI categorization is enabled, it can take up to five minutes from submitting a transaction to choose a ledger and generate the journal. Also, since large language models are probabilistic, if you run the same transaction through AI categorization twice it may return two different answers if there are multiple plausible ledgers for a transaction.

Our categorization LLM is under active development and you can expect the accuracy and speed to improve in the coming months.



